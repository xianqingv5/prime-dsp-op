"use strict";var _slicedToArray=function(a,t){if(Array.isArray(a))return a;if(Symbol.iterator in Object(a))return function(a,t){var e=[],n=!0,r=!1,i=void 0;try{for(var c,l=a[Symbol.iterator]();!(n=(c=l.next()).done)&&(e.push(c.value),!t||e.length!==t);n=!0);}catch(a){r=!0,i=a}finally{try{!n&&l.return&&l.return()}finally{if(r)throw i}}return e}(a,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")};$(function(){var p;common.pluginsTools.loadPlugins(function(){var n=1,a=common.getUrlVars("campaignId","approvalStatus","showClosed"),t=_slicedToArray(a,3),e=t[0],r=t[1],i=t[2],c="campaignId="+e+"&approvalStatus="+r+"&adStatus="+(i?"1,2,3":"");$("#adList").on("click","[check-all-ad]",function(){$(this).parents(".ad-container:first").find(".platform-container input").prop("checked","checked")}),$("#adList").on("click","[apply-to-all]",function(){var a=$(this).parents(".ad-container:first"),t={};$("[platformId]",a).each(function(){var a=$(this).attr("platformId");t[a]=$(this).prop("checked")}),$("#adList").find(".ad-container [platformId]").each(function(){var a=$(this).attr("platformId");$(this).prop("checked",t[a])});var e=a.find(".ad-reason").val();return $("#adList").find(".ad-reason").val(e),!1}),$("#adList").on("click","[shield]",function(){var a=parseInt($(this).attr("shield"));$(this).parents(".ad-container:first").find(":checkbox[level]").prop("checked",!0).each(function(){parseInt($(this).attr("level"))<=a&&$(this).removeProp("checked")})}),$("button.submitAndExit").unbind().on("click",function(){var s,a,o;s=!1,a=$("form").serializeArray().reduce(function(a,t){return a[t.name]=t.value,a},{}),o={approveAds:[],runOnAlert:"on"==a.runOnAlert?1:0,geoRunOnAlert:"on"==a.geoRunOnAlert?1:0,inmobiRunOnAlert:"on"==a.inmobiRunOnAlert?1:0},$(".ad-container").each(function(a){var t=$(this),e=t.attr("adId"),n=t.find(".ad-reason").val()||"",r=[],i=!(t.find("[platformId]").size()-t.find("[platformId]:checked").size());t.find("[platformId]:checked").each(function(a){r.push($(this).attr("platformId"))});var c=p.creativeList[a],l={adId:e,reason:n,approvedPlatform:r,bannerUrl:c.bannerUrl,iconUrl:c.iconUrl,picUrl:c.picUrl,videoUrl:c.videoUrl,html:c.html};i||""!=n||(s=!0,alert("[adID:"+e+"]审核未通过或部分通过的创意必须填写原因")),o.approveAds.push(l)}),s||common.ajaxPost("batchApproveAd",o).done(function(a){0==a.status?(common.msgs.new_msg("success","success"),window.location="./index.html?goto=audit&mold=list"):common.msgs.new_msg("error","提交失败")})}),$("button.cancel").unbind().on("click",function(){window.location.href="index.html?goto=audit&mold=list"}),common.ajaxRequest("queryCampaignApproveInfo",c,function(a){var t,e;0==a.status&&(document.title=a.data.campaignId+":"+a.data.campaignName+" | "+document.title,t={},a.data.platforms.sort(function(a,t){return a.class>=t.class?1:-1}),a.data.platforms.forEach(function(a){t[l[a.class-1]]=t[l[a.class-1]]||[],t[l[a.class-1]].push(a)}),n=a.data.platforms[a.data.platforms.length-1].class,a.data.classGroup=t,a&&((e=a.data).countryWl=JSON.parse('{"0":'+e.countryWl+"}")[0].map(function(a){return a.name}),e.creativeList.forEach(function(a){a.approvedPlatform=JSON.parse(a.approvedPlatform)}),$("#campaignDetail").html(template("campaignDetailTmp",{data:e})),$("#adList").html(template("adListTmp",{adList:e.creativeList,campaign:e}))),p=a.data,function(a){var t=template.compile('\n            <%for(var i = 0; i < max; i++){%>\n                <a href="javascript:;" class="btn btn-primary" shield="<%= i + 1 %>"><%= LEVEL[i] %></a>\n            <%}%>');$("#shield-main").append(t({max:a,LEVEL:l}));var e=template.compile('\n            <%for(var i = 0; i < max; i++){%>\n                <a href="javascript:;" class="btn btn-default" shield="<%= i + 1 %>"><%= LEVEL[i] %></a>\n            <%}%>');$(".ad-container .tools").append(e({max:a,LEVEL:l}))}(n))}),function(){template.helper("handleStatus",function(a){switch(a){case 1:return'<span class="label label-default">审核中</span>';case 2:return'<span class="label label-success">通过</span>';case 3:return'<span class="label label-danger">未通过</span>';case 4:return'<span class="label label-warning">部分通过</span>';default:return""}}),template.helper("campaignStatus",function(a){switch(a){case 1:return"Active";case 2:return"Paused";case 3:return"Deleted";default:return"Unknown"}}),template.helper("adStatus",function(a){switch(a){case 1:return"Active";case 2:return"Paused";case 3:return"Deleted";default:return"Unknown"}}),template.helper("tmt",function(a){return 0==a?'<span class="label label-danger">有报警！</span>':1==a?'<span class="label label-success">无报警</span>':2==a?'<span class="label label-default">扫描中</span>':void 0});var e={0:"不限",1:"移动网站流量",2:"移动应用流量"};template.helper("trafficType",function(a){var t=[];try{t=JSON.parse(a)}catch(a){}return t.length||(t=[0]),(t=_.map(t,function(a){return e[a]})).join(",")}),template.helper("parseInt",function(a){return parseInt(a)}),template.helper("forin",function(t,e){Object.keys(t).forEach(function(a){return e(t[a],a)})}),template.helper("linkType",function(a){return{1:"Banner",2:"Jstag",3:"Video",4:"Pop",5:"Pop prime",6:"Native"}[a]||"UNKNOWN"})}(),function(){var a=$(".shield");a.on("click","a[shield]",function(){var a=parseInt($(this).attr("shield"));$("#adList :checkbox").prop("checked",!0),$("#adList").find(":checkbox[level]").each(function(){parseInt($(this).attr("level"))<=a&&$(this).removeProp("checked")})}),a.on("click","a[check-all]",function(){$("#adList :checkbox").prop("checked",!0)})}()},["template"]);var l="ABCDEFGHIJKL"});