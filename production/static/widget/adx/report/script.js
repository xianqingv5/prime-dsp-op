"use strict";function defaultResultMapper(t){return _.defaults(t,{id:"",token:"",name:""})}$(function(){$("#sub-nav").html('\n        <li class="active"><a href="javascript:;">Adx报表</a></li>\n        <li><a href="?goto=adx&mold=list">Adx管理</a></li>\n    ').show();$("#userInfomation").attr("roleId");var t={startDate:moment(),singleDatePicker:!1,opens:"left",showDropdowns:!0,locale:{format:"YYYY-MM-DD",separator:" / ",applyLabel:"ok",cancelLabel:"cancel",customRangeLabel:"custom"},ranges:{"今天":[moment.utc(),moment.utc()],"昨天":[moment.utc().subtract(1,"days"),moment.utc().subtract(1,"days")],"前天":[moment.utc().subtract(2,"days"),moment.utc().subtract(2,"days")],"3天内":[moment.utc().subtract(2,"days"),moment.utc()],"7天内":[moment.utc().subtract(6,"days"),moment.utc()],"30天内":[moment.utc().subtract(29,"days"),moment.utc()]}};common.pluginsTools.loadPlugins(function(){$("input[daterange]").daterangepicker(t),template.helper("numeral",function(){return numeral.apply(void 0,arguments)}),a.on("click",function(t){t.preventDefault(),t.stopPropagation(),$inputs.val(""),$radios.removeProp("checked"),m()}),e.on("submit",function(){return m(i()),!1}),$("#adx-selector").on("change",function(t){m()}),$("#datetime").on("change",function(){m()}),$("#list").on("click","[platformId]",function(){var t=$(this).attr("platformId");$("#adx-selector").val(t).trigger("change.select2"),m({platformId:t,groupBy:"platformdate"})}).on("click","[campaign-list]",function(){!function(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=$("#list").find("#adx-detail-"+t);if(e.data("display"))return e.data("display",!1).empty(),e.hide();e.show().data("display",!0);var n=_.extend({},i(),a),o="queryAdExchangeDetailReport?adx="+n.platformId+"&platformId="+n.platformId+"&date="+t.split(" ")[0];common.ajaxGet(o).then(function(t){0==t.status&&e.html(template("campaignList",{data:t.data.list}))})}($(this).attr("campaign-list"))}),m(),common.ajaxGet("queryAdExchange").then(function(t){0==t.status&&function(t){if($("#adx-selector").data("complate"))return;$("#adx-selector").data("complate",!0),$("#adx-selector").append(t.map(function(t){return'<option value="'+t.id+'">'+t.name+"</option>"})),$("#adx-selector").select2()}(t.data.list)})},["template","datetimepicker","select2"]),common.pluginsTools.loadCss("datetimepickerCss");var e=$("#form-container"),a=($("#submit"),$("#reset")),o=($("#more-param"),common.PageRender($(".page"),m)),r=function(t){var a=0<arguments.length&&void 0!==t?t:{};return $("#list").html(template("materialsList",Object.assign({loading:!1,data:null},a)))};var l=function(t){return $("#table-header").html(template(t))};function i(){var t=e.serializeJSON();t.platformId=$("#adx-selector").val(),0==t.platformId?delete t.platformId:t.groupBy="platformdate";var a=t.time.split("/");return t.startTime=$.trim(a[0]),t.endTime=$.trim(a[1]),delete t.time,t}function m(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=_.extend({},i(),t);for(var a in _.defaults(n,{currentPage:1,limit:50}),n)void 0!==n[a]&&""!==n[a]||delete n[a];m.require&&m.require.abort&&m.require.abort(),r({loading:!0}),m.require=common.ajaxGet("queryAdExchangeReport",n),m.require.then(function(t){if(0==t.status){var a=t.data&&0==t.data.list.length?[]:t.data.list.map(defaultResultMapper);if(n.groupBy)for(var e=0;e<a.length;e++)a[e].dateForm=a[e].date.split(" ")[0];l("platformdate"==n.groupBy?"thead-platform-date":"thead-platform"),r({data:a}),o(t.data.paging),$(".btn-toolbar").children("button").remove(),$(".table#adx-report").tableExport({formats:["xlsx"]})}t.status&&(r(),o())})}});