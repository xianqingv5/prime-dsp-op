"use strict";function defaultResultMapper(t){return _.defaults(t,{id:"",token:"",name:""})}$(function(){$("#sub-nav").html('\n        <li class="active"><a href="javascript:;">Adx报表</a></li>\n        <li><a href="?goto=adx&mold=list">Adx管理</a></li>\n    ').show();$("#userInfomation").attr("roleId");var t={startDate:moment(),singleDatePicker:!1,opens:"left",showDropdowns:!0,locale:{format:"YYYY-MM-DD",separator:" / ",applyLabel:"ok",cancelLabel:"cancel",customRangeLabel:"custom"},ranges:{"今天":[moment.utc(),moment.utc()],"昨天":[moment.utc().subtract(1,"days"),moment.utc().subtract(1,"days")],"前天":[moment.utc().subtract(2,"days"),moment.utc().subtract(2,"days")],"3天内":[moment.utc().subtract(2,"days"),moment.utc()],"7天内":[moment.utc().subtract(6,"days"),moment.utc()],"30天内":[moment.utc().subtract(29,"days"),moment.utc()]}};common.pluginsTools.loadPlugins(function(){$("input[daterange]").daterangepicker(t),template.helper("numeral",function(){return numeral.apply(void 0,arguments)}),e.on("click",function(t){t.preventDefault(),t.stopPropagation(),$inputs.val(""),$radios.removeProp("checked"),i()}),a.on("submit",function(){return i(l()),!1}),$("#adx-selector").on("change",function(t){i()}),$("#datetime").on("change",function(){i()}),$("#list").on("click","[platformId]",function(){var t=$(this).attr("platformId");$("#adx-selector").val(t).trigger("change.select2"),i({platformId:t,groupBy:"platformdate"})}).on("click","[campaign-list]",function(){var t=$(this).attr("campaign-list");!function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=$("#list").find("#adx-detail-"+t);if(e.data("display"))return e.data("display",!1).empty(),e.hide();e.show().data("display",!0);var n=_.extend({},l(),a),o="queryAdExchangeDetailReport?adx="+n.platformId+"&platformId="+n.platformId+"&date="+t.split(" ")[0];common.ajaxGet(o).then(function(t){0==t.status&&e.html(template("campaignList",{data:t.data.list}))})}(t)}),i(),common.ajaxGet("queryAdExchange").then(function(t){0==t.status&&function(t){if($("#adx-selector").data("complate"))return!1;$("#adx-selector").data("complate",!0),$("#adx-selector").append(t.map(function(t){return'<option value="'+t.id+'">'+t.name+"</option>"})),$("#adx-selector").select2()}(t.data.list)})},["template","datetimepicker","select2"]),common.pluginsTools.loadCss("datetimepickerCss");var a=$("#form-container"),e=($("#submit"),$("#reset")),n=($("#more-param"),common.PageRender($(".page"),i)),o=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return $("#list").html(template("materialsList",Object.assign({loading:!1,data:null},t)))};var r=function(t){return $("#table-header").html(template(t))};function l(){var t=a.serializeJSON();t.platformId=$("#adx-selector").val(),0==t.platformId?delete t.platformId:t.groupBy="platformdate";var e=t.time.split("/");return t.startTime=$.trim(e[0]),t.endTime=$.trim(e[1]),delete t.time,t}function i(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=_.extend({},l(),t);for(var e in _.defaults(a,{currentPage:1,limit:50}),a)void 0!==a[e]&&""!==a[e]||delete a[e];i.require&&i.require.abort&&i.require.abort(),o({loading:!0}),(i.require=common.ajaxGet("queryAdExchangeReport",a)).then(function(t){if(0==t.status){var e=t.data&&0==t.data.list.length?[]:t.data.list.map(defaultResultMapper);if(a.groupBy)for(var l=0;l<e.length;l++)e[l].dateForm=e[l].date.split(" ")[0];r("platformdate"==a.groupBy?"thead-platform-date":"thead-platform"),o({data:e}),n(t.data.paging),$(".btn-toolbar").children("button").remove(),$(".table#adx-report").tableExport({formats:["xlsx"]})}t.status&&(o(),n())})}});